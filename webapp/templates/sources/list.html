{% extends "base.html" %}

{% block title %}Content Sources - {{ profile.name }}{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">
    <!-- Header -->
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-xl);">
        <div>
            <div style="display: flex; align-items: center; gap: var(--space-md); margin-bottom: var(--space-xs);">
                <a href="/profiles/{{ profile.id }}" style="color: var(--text-secondary); font-size: 1.25rem; text-decoration: none;">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <h1 style="font-size: 1.75rem; font-weight: 700; color: var(--text-primary);">Content Sources</h1>
            </div>
            <p style="color: var(--text-secondary); margin-left: calc(1.25rem + var(--space-md));">
                Manage where {{ profile.name }} gets its content
            </p>
        </div>
        <a href="/profiles/{{ profile.id }}/sources/new" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Source
        </a>
    </div>

    <!-- Sources List -->
    <div class="card" style="overflow: hidden; padding: 0;">
        {% if sources %}
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: var(--bg-tertiary);">
                    <th style="text-align: left; padding: var(--space-md) var(--space-lg); font-size: 0.875rem; font-weight: 500; color: var(--text-secondary);">Source</th>
                    <th style="text-align: left; padding: var(--space-md) var(--space-lg); font-size: 0.875rem; font-weight: 500; color: var(--text-secondary);">Type</th>
                    <th style="text-align: left; padding: var(--space-md) var(--space-lg); font-size: 0.875rem; font-weight: 500; color: var(--text-secondary);">Categories</th>
                    <th style="text-align: center; padding: var(--space-md) var(--space-lg); font-size: 0.875rem; font-weight: 500; color: var(--text-secondary);">Priority</th>
                    <th style="text-align: center; padding: var(--space-md) var(--space-lg); font-size: 0.875rem; font-weight: 500; color: var(--text-secondary);">Status</th>
                    <th style="text-align: right; padding: var(--space-md) var(--space-lg); font-size: 0.875rem; font-weight: 500; color: var(--text-secondary);">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for source in sources %}
                <tr style="border-top: 1px solid var(--border-color); {{ 'opacity: 0.5;' if not source.is_active }}" class="source-row">
                    <td style="padding: var(--space-md) var(--space-lg);">
                        <div style="display: flex; align-items: center; gap: var(--space-md);">
                            <div style="width: 40px; height: 40px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;
                                {% if source.source_type == 'reddit' %}background: #fff3e0; color: #ff5722;
                                {% elif source.source_type == 'rss' %}background: #e3f2fd; color: #2196f3;
                                {% elif source.source_type == 'google_news' %}background: #e8f5e9; color: #4caf50;
                                {% else %}background: var(--bg-tertiary); color: var(--text-secondary);{% endif %}">
                                {% if source.source_type == 'reddit' %}
                                <i class="fab fa-reddit-alien"></i>
                                {% elif source.source_type == 'rss' %}
                                <i class="fas fa-rss"></i>
                                {% elif source.source_type == 'google_news' %}
                                <i class="fab fa-google"></i>
                                {% else %}
                                <i class="fas fa-globe"></i>
                                {% endif %}
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">{{ source.name }}</div>
                                <div style="font-size: 0.8125rem; color: var(--text-tertiary);">
                                    {% if source.source_type == 'reddit' %}
                                    r/{{ source.config.get('subreddit', 'unknown') }}
                                    {% elif source.source_type == 'rss' %}
                                    {{ source.config.get('url', 'No URL')[:40] }}{% if source.config.get('url', '')|length > 40 %}...{% endif %}
                                    {% elif source.source_type == 'google_news' %}
                                    "{{ source.config.get('query', 'No query') }}"
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td style="padding: var(--space-md) var(--space-lg);">
                        <span style="padding: 4px 10px; font-size: 0.75rem; border-radius: var(--radius-full); font-weight: 500;
                            {% if source.source_type == 'reddit' %}background: #fff3e0; color: #e65100;
                            {% elif source.source_type == 'rss' %}background: #e3f2fd; color: #1565c0;
                            {% elif source.source_type == 'google_news' %}background: #e8f5e9; color: #2e7d32;
                            {% else %}background: var(--bg-tertiary); color: var(--text-secondary);{% endif %}">
                            {{ source.source_type | replace('_', ' ') | title }}
                        </span>
                    </td>
                    <td style="padding: var(--space-md) var(--space-lg);">
                        <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                            {% for cat in (source.categories or [])[:3] %}
                            <span style="padding: 2px 8px; background: var(--accent-light); color: var(--accent); font-size: 0.75rem; border-radius: var(--radius-sm);">{{ cat }}</span>
                            {% endfor %}
                            {% if (source.categories or [])|length > 3 %}
                            <span style="font-size: 0.75rem; color: var(--text-tertiary);">+{{ (source.categories|length) - 3 }}</span>
                            {% endif %}
                            {% if not source.categories %}
                            <span style="font-size: 0.8125rem; color: var(--text-tertiary);">-</span>
                            {% endif %}
                        </div>
                    </td>
                    <td style="padding: var(--space-md) var(--space-lg); text-align: center;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 2px;">
                            {% for i in range(10) %}
                            <div style="width: 6px; height: 6px; border-radius: 50%; {{ 'background: var(--accent);' if i < source.priority else 'background: var(--border-color);' }}"></div>
                            {% endfor %}
                        </div>
                        <span style="font-size: 0.75rem; color: var(--text-tertiary);">{{ source.priority }}/10</span>
                    </td>
                    <td style="padding: var(--space-md) var(--space-lg); text-align: center;">
                        <form method="POST" action="/profiles/{{ profile.id }}/sources/{{ source.id }}/toggle" style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" style="padding: 4px 12px; border-radius: var(--radius-full); font-size: 0.75rem; font-weight: 500; border: none; cursor: pointer; {{ 'background: var(--success-light); color: var(--success);' if source.is_active else 'background: var(--bg-tertiary); color: var(--text-tertiary);' }}">
                                {{ 'Active' if source.is_active else 'Inactive' }}
                            </button>
                        </form>
                    </td>
                    <td style="padding: var(--space-md) var(--space-lg); text-align: right;">
                        <form method="POST" action="/profiles/{{ profile.id }}/sources/{{ source.id }}/delete"
                              style="display: inline;" onsubmit="return confirm('Delete this source?')">
                            <button type="submit" style="background: none; border: none; color: var(--error); cursor: pointer; padding: var(--space-sm);"
                                    aria-label="Delete source {{ source.name }}" title="Delete source">
                                <i class="fas fa-trash" aria-hidden="true"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <!-- Empty State -->
        <div style="text-align: center; padding: var(--space-2xl);">
            <div style="width: 64px; height: 64px; margin: 0 auto var(--space-lg); background: var(--bg-tertiary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-rss" style="font-size: 1.5rem; color: var(--text-tertiary);"></i>
            </div>
            <h3 style="font-size: 1.125rem; font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-sm);">No Content Sources</h3>
            <p style="color: var(--text-secondary); margin-bottom: var(--space-lg);">Add sources to start gathering content for your podcast</p>
            <a href="/profiles/{{ profile.id }}/sources/new" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add Your First Source
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Info Box -->
    <div class="card" style="background: var(--accent-light); border: 1px solid #cce0ff; margin-top: var(--space-xl);">
        <h3 style="font-weight: 600; color: var(--accent); margin-bottom: var(--space-md);">
            <i class="fas fa-info-circle"></i> About Content Sources
        </h3>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg);">
            <div>
                <strong style="color: #e65100; font-size: 0.875rem;"><i class="fab fa-reddit-alien"></i> Reddit</strong>
                <p style="font-size: 0.8125rem; color: var(--text-secondary); margin-top: var(--space-xs);">
                    Pulls top posts from subreddits. Great for community discussions and trending topics.
                </p>
            </div>
            <div>
                <strong style="color: #1565c0; font-size: 0.875rem;"><i class="fas fa-rss"></i> RSS Feeds</strong>
                <p style="font-size: 0.8125rem; color: var(--text-secondary); margin-top: var(--space-xs);">
                    News articles from publications. Best for authoritative news coverage.
                </p>
            </div>
            <div>
                <strong style="color: #2e7d32; font-size: 0.875rem;"><i class="fab fa-google"></i> Google News</strong>
                <p style="font-size: 0.8125rem; color: var(--text-secondary); margin-top: var(--space-xs);">
                    Search-based news. Useful for specific topics or breaking news.
                </p>
            </div>
        </div>
    </div>
</div>

<style>
    .source-row:hover {
        background: var(--bg-secondary);
    }
</style>
{% endblock %}
