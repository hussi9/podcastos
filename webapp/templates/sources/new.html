{% extends "base.html" %}

{% block title %}Add Source - {{ profile.name }}{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <!-- Header -->
    <div style="margin-bottom: var(--space-xl);">
        <div style="display: flex; align-items: center; gap: var(--space-md); margin-bottom: var(--space-xs);">
            <a href="/profiles/{{ profile.id }}/sources"
                style="color: var(--color-text-secondary); font-size: 1.25rem;">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1>Add Content Source</h1>
        </div>
        <p style="color: var(--color-text-secondary); margin-left: calc(1.25rem + var(--space-md));">
            Add a new content source to {{ profile.name }}
        </p>
    </div>

    <!-- Form -->
    <form method="POST" id="sourceForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="card">
            <h3
                style="margin-bottom: var(--space-lg); padding-bottom: var(--space-md); border-bottom: 1px solid var(--border-color-dim);">
                Source Details
            </h3>

            <div class="form-group">
                <label class="form-label">Source Name *</label>
                <input type="text" name="name" required placeholder="e.g., r/immigration, Tech News" class="form-input">
            </div>

            <div class="form-group">
                <label class="form-label">Source Type *</label>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-md);">
                    <label class="radio-card">
                        <input type="radio" name="source_type" value="reddit" checked style="display: none;">
                        <div class="radio-card-content">
                            <i class="fab fa-reddit-alien"
                                style="font-size: 1.5rem; margin-bottom: var(--space-sm); color: #ff4500;"></i>
                            <div style="font-weight: 600;">Reddit</div>
                            <div style="font-size: 0.75rem; color: var(--color-text-secondary);">Subreddits</div>
                        </div>
                    </label>

                    <label class="radio-card">
                        <input type="radio" name="source_type" value="rss" style="display: none;">
                        <div class="radio-card-content">
                            <i class="fas fa-rss"
                                style="font-size: 1.5rem; margin-bottom: var(--space-sm); color: #fb923c;"></i>
                            <div style="font-weight: 600;">RSS Feed</div>
                            <div style="font-size: 0.75rem; color: var(--color-text-secondary);">News feeds</div>
                        </div>
                    </label>

                    <label class="radio-card">
                        <input type="radio" name="source_type" value="google_news" style="display: none;">
                        <div class="radio-card-content">
                            <i class="fab fa-google"
                                style="font-size: 1.5rem; margin-bottom: var(--space-sm); color: #4285f4;"></i>
                            <div style="font-weight: 600;">Google News</div>
                            <div style="font-size: 0.75rem; color: var(--color-text-secondary);">Search queries</div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Reddit Options -->
            <div id="redditOptions" class="source-options">
                <div class="form-group">
                    <label class="form-label">Subreddit Name *</label>
                    <div style="display: flex;">
                        <span
                            style="padding: 0.625rem 1rem; background: var(--color-bg-base); border: 1px solid var(--border-color-dim); border-right: none; border-radius: var(--border-radius-md) 0 0 var(--border-radius-md); color: var(--color-text-muted);">
                            r/
                        </span>
                        <input type="text" name="subreddit" placeholder="immigration" class="form-input"
                            style="border-top-left-radius: 0; border-bottom-left-radius: 0;">
                    </div>
                    <p style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 4px;">Enter just the
                        subreddit name without r/</p>
                </div>
            </div>

            <!-- RSS Options -->
            <div id="rssOptions" class="source-options hidden">
                <div class="form-group">
                    <label class="form-label">RSS Feed URL *</label>
                    <input type="url" name="rss_url" placeholder="https://example.com/feed.xml" class="form-input">
                    <p style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 4px;">Full URL to the RSS
                        or Atom feed</p>
                </div>
            </div>

            <!-- Google News Options -->
            <div id="googleOptions" class="source-options hidden">
                <div class="form-group">
                    <label class="form-label">Search Query *</label>
                    <input type="text" name="search_query" placeholder="H1B visa news" class="form-input">
                    <p style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 4px;">Google News search
                        query</p>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg);">
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <select name="priority" class="form-select">
                        <option value="10">10 - Highest</option>
                        <option value="9">9</option>
                        <option value="8">8</option>
                        <option value="7">7</option>
                        <option value="6">6</option>
                        <option value="5" selected>5 - Medium</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="1">1 - Lowest</option>
                    </select>
                    <p style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 4px;">Higher priority
                        sources are used first</p>
                </div>

                <div class="form-group">
                    <label class="form-label">Categories</label>
                    <input type="text" name="categories" placeholder="immigration, career (comma-separated)"
                        class="form-input">
                    <p style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 4px;">Filter content by
                        category</p>
                </div>
            </div>
        </div>

        <!-- Submit -->
        <div style="display: flex; justify-content: flex-end; gap: var(--space-md);">
            <a href="/profiles/{{ profile.id }}/sources" class="btn btn-secondary">
                Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add Source
            </button>
        </div>
    </form>
</div>

<style>
    /* Local styles for radio cards */
    .radio-card-content {
        border: 1px solid var(--border-color-dim);
        border-radius: var(--border-radius-lg);
        padding: var(--space-md);
        text-align: center;
        cursor: pointer;
        transition: all var(--transition-fast);
        background-color: var(--color-bg-base);
    }

    .radio-card input:checked+.radio-card-content {
        border-color: var(--color-accent-primary);
        background-color: var(--color-accent-subtle);
        box-shadow: 0 0 0 1px var(--color-accent-primary);
    }

    .radio-card-content:hover {
        border-color: var(--color-text-secondary);
        background-color: var(--color-bg-hover);
    }
</style>

<script>
    // Toggle source options based on type selection
    document.querySelectorAll('input[name="source_type"]').forEach(radio => {
        radio.addEventListener('change', function () {
            document.querySelectorAll('.source-options').forEach(el => el.classList.add('hidden'));

            if (this.value === 'reddit') {
                document.getElementById('redditOptions').classList.remove('hidden');
            } else if (this.value === 'rss') {
                document.getElementById('rssOptions').classList.remove('hidden');
            } else if (this.value === 'google_news') {
                document.getElementById('googleOptions').classList.remove('hidden');
            }
        });
    });
</script>
{% endblock %}