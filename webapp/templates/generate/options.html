{% extends "base.html" %}

{% block title %}Generate Episode - {{ profile.name }}{% endblock %}

{% block extra_css %}
<style>
    .generate-container {
        max-width: 900px;
        margin: 0 auto;
    }

    /* Header */
    .generate-header {
        display: flex;
        align-items: center;
        gap: var(--space-lg);
        margin-bottom: var(--space-xl);
    }

    .generate-header .profile-avatar {
        width: 64px;
        height: 64px;
        border-radius: var(--radius-lg);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }

    .generate-header-info h1 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: var(--space-xs);
    }

    .generate-header-info p {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    /* Progress Steps */
    .generation-steps {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--space-2xl);
        position: relative;
    }

    .generation-steps::before {
        content: '';
        position: absolute;
        top: 20px;
        left: 40px;
        right: 40px;
        height: 2px;
        background: var(--bg-tertiary);
    }

    .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--space-sm);
        position: relative;
        z-index: 1;
    }

    .step-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--bg-tertiary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .step.active .step-icon {
        background: var(--accent);
        color: white;
    }

    .step-label {
        font-size: 0.8rem;
        color: var(--text-secondary);
        text-align: center;
    }

    .step.active .step-label {
        color: var(--accent);
        font-weight: 500;
    }

    /* Section Cards */
    .section-card {
        margin-bottom: var(--space-lg);
    }

    .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: var(--space-lg);
    }

    .section-title {
        font-size: 1.1rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }

    .section-title i {
        color: var(--accent);
    }

    /* Input Groups */
    .input-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-lg);
    }

    @media (max-width: 640px) {
        .input-grid {
            grid-template-columns: 1fr;
        }
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: var(--space-xs);
    }

    .form-label {
        font-weight: 500;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }

    .form-label .optional {
        color: var(--text-tertiary);
        font-weight: 400;
        font-size: 0.8rem;
    }

    .form-input, .form-select, .form-textarea {
        padding: var(--space-md);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        font-size: 0.95rem;
        background: var(--bg-primary);
        transition: all var(--transition-fast);
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--accent-light);
    }

    .form-textarea {
        resize: vertical;
        min-height: 100px;
    }

    .form-help {
        font-size: 0.8rem;
        color: var(--text-secondary);
    }

    /* Toggle Options */
    .toggle-option {
        display: flex;
        align-items: flex-start;
        gap: var(--space-md);
        padding: var(--space-md);
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .toggle-option:hover {
        background: var(--bg-tertiary);
    }

    .toggle-option input[type="checkbox"] {
        width: 20px;
        height: 20px;
        margin-top: 2px;
        cursor: pointer;
    }

    .toggle-info h4 {
        font-weight: 500;
        margin-bottom: var(--space-xs);
    }

    .toggle-info p {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    /* Radio Cards */
    .radio-cards {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-md);
    }

    @media (max-width: 640px) {
        .radio-cards {
            grid-template-columns: 1fr;
        }
    }

    .radio-card {
        position: relative;
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: var(--space-md);
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .radio-card:hover {
        border-color: var(--accent);
    }

    .radio-card input[type="radio"] {
        position: absolute;
        opacity: 0;
    }

    .radio-card.selected {
        border-color: var(--accent);
        background: var(--accent-light);
    }

    .radio-card-header {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        margin-bottom: var(--space-xs);
    }

    .radio-card-icon {
        width: 32px;
        height: 32px;
        border-radius: var(--radius-sm);
        background: var(--bg-tertiary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
    }

    .radio-card.selected .radio-card-icon {
        background: var(--accent);
        color: white;
    }

    .radio-card-title {
        font-weight: 600;
        font-size: 0.95rem;
    }

    .radio-card-desc {
        font-size: 0.8rem;
        color: var(--text-secondary);
    }

    /* Duration Slider */
    .duration-slider-container {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
    }

    .duration-display {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .duration-value {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--accent);
    }

    .duration-estimate {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .duration-slider {
        width: 100%;
        height: 8px;
        border-radius: var(--radius-full);
        background: var(--bg-tertiary);
        appearance: none;
        cursor: pointer;
    }

    .duration-slider::-webkit-slider-thumb {
        appearance: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--accent);
        cursor: pointer;
        box-shadow: var(--shadow-md);
    }

    .duration-marks {
        display: flex;
        justify-content: space-between;
        font-size: 0.75rem;
        color: var(--text-tertiary);
    }

    /* Host Selection */
    .host-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: var(--space-md);
    }

    .host-card {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        padding: var(--space-md);
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .host-card:hover {
        border-color: var(--accent);
    }

    .host-card.selected {
        border-color: var(--accent);
        background: var(--accent-light);
    }

    .host-card input[type="checkbox"] {
        display: none;
    }

    .host-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.25rem;
    }

    .host-info h4 {
        font-weight: 500;
        margin-bottom: var(--space-xs);
    }

    .host-info p {
        font-size: 0.8rem;
        color: var(--text-secondary);
    }

    /* Estimate Card */
    .estimate-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: var(--space-lg);
        border-radius: var(--radius-lg);
        margin-bottom: var(--space-xl);
    }

    .estimate-header {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: var(--space-md);
    }

    .estimate-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--space-md);
    }

    @media (max-width: 640px) {
        .estimate-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .estimate-item {
        text-align: center;
    }

    .estimate-value {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: var(--space-xs);
    }

    .estimate-label {
        font-size: 0.8rem;
        opacity: 0.8;
    }

    /* Action Bar */
    .action-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-lg);
        background: var(--bg-primary);
        border-top: 1px solid var(--border-color);
        position: sticky;
        bottom: 0;
        margin: 0 calc(-1 * var(--space-lg));
        margin-top: var(--space-xl);
    }

    .action-bar-info {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .action-buttons {
        display: flex;
        gap: var(--space-md);
    }

    /* Collapsible Sections */
    .collapsible-section {
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        overflow: hidden;
        margin-bottom: var(--space-lg);
    }

    .collapsible-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-md) var(--space-lg);
        background: var(--bg-secondary);
        cursor: pointer;
        transition: background var(--transition-fast);
    }

    .collapsible-header:hover {
        background: var(--bg-tertiary);
    }

    .collapsible-title {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        font-weight: 500;
    }

    .collapsible-toggle {
        transition: transform var(--transition-fast);
    }

    .collapsible-section.open .collapsible-toggle {
        transform: rotate(180deg);
    }

    .collapsible-content {
        padding: var(--space-lg);
        display: none;
    }

    .collapsible-section.open .collapsible-content {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="generate-container">
    <!-- Header -->
    <div class="generate-header">
        <a href="/profiles/{{ profile.id }}" class="btn btn-ghost" title="Back to podcast">
            <i class="fas fa-arrow-left"></i>
        </a>
        <div class="profile-avatar">
            <i class="fas fa-podcast"></i>
        </div>
        <div class="generate-header-info">
            <h1>Generate New Episode</h1>
            <p>{{ profile.name }} - Configure your episode settings</p>
        </div>
    </div>

    <!-- Progress Steps -->
    <div class="generation-steps">
        <div class="step active">
            <div class="step-icon"><i class="fas fa-cog"></i></div>
            <span class="step-label">Configure</span>
        </div>
        <div class="step">
            <div class="step-icon"><i class="fas fa-search"></i></div>
            <span class="step-label">Research</span>
        </div>
        <div class="step">
            <div class="step-icon"><i class="fas fa-pen"></i></div>
            <span class="step-label">Script</span>
        </div>
        <div class="step">
            <div class="step-icon"><i class="fas fa-microphone"></i></div>
            <span class="step-label">Audio</span>
        </div>
        <div class="step">
            <div class="step-icon"><i class="fas fa-check"></i></div>
            <span class="step-label">Complete</span>
        </div>
    </div>

    <!-- Estimate Card -->
    <div class="estimate-card" id="estimate-card">
        <div class="estimate-header">Estimated Generation</div>
        <div class="estimate-grid">
            <div class="estimate-item">
                <div class="estimate-value" id="est-time">~8 min</div>
                <div class="estimate-label">Processing Time</div>
            </div>
            <div class="estimate-item">
                <div class="estimate-value" id="est-duration">15 min</div>
                <div class="estimate-label">Episode Length</div>
            </div>
            <div class="estimate-item">
                <div class="estimate-value" id="est-cost">$0.25</div>
                <div class="estimate-label">Est. Cost</div>
            </div>
            <div class="estimate-item">
                <div class="estimate-value" id="est-output">3</div>
                <div class="estimate-label">Output Files</div>
            </div>
        </div>
    </div>

    <form method="POST" id="generation-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <!-- Topic Section -->
        <div class="card section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-lightbulb"></i>
                    Episode Topic
                </h2>
            </div>

            <div class="form-group" style="margin-bottom: var(--space-lg);">
                <label class="form-label">
                    Main Topic <span class="optional">(Optional)</span>
                </label>
                <input type="text" name="focus" class="form-input"
                       placeholder="e.g., Latest developments in AI regulation"
                       id="topic-input">
                <p class="form-help">Leave blank to auto-discover trending topics from your sources</p>
            </div>

            <div class="form-group">
                <label class="form-label">
                    Additional Instructions <span class="optional">(Optional)</span>
                </label>
                <textarea name="instructions" class="form-textarea"
                          placeholder="Any special instructions for this episode..."></textarea>
                <p class="form-help">Guide the AI on tone, specific points to cover, or segments to include</p>
            </div>
        </div>

        <!-- Duration & Topics -->
        <div class="card section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-clock"></i>
                    Duration & Content
                </h2>
            </div>

            <div class="input-grid">
                <div class="form-group">
                    <label class="form-label">Episode Duration</label>
                    <div class="duration-slider-container">
                        <div class="duration-display">
                            <span class="duration-value" id="duration-value">15 min</span>
                            <span class="duration-estimate" id="duration-estimate">~2,500 words</span>
                        </div>
                        <input type="range" name="duration" class="duration-slider"
                               min="5" max="45" value="{{ profile.target_duration_minutes or 15 }}"
                               id="duration-slider" oninput="updateDuration(this.value)">
                        <div class="duration-marks">
                            <span>5 min</span>
                            <span>15 min</span>
                            <span>30 min</span>
                            <span>45 min</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Number of Topics</label>
                    <select name="topic_count" class="form-select" id="topic-count" onchange="updateEstimate()">
                        {% for i in range(2, 10) %}
                        <option value="{{ i }}" {% if i == (profile.topic_count or 5) %}selected{% endif %}>
                            {{ i }} topics
                        </option>
                        {% endfor %}
                    </select>
                    <p class="form-help">More topics = broader coverage, fewer topics = deeper analysis</p>
                </div>
            </div>
        </div>

        {% if profile.hosts and profile.hosts|length > 1 %}
        <!-- Host Selection -->
        <div class="card section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-users"></i>
                    Hosts
                </h2>
            </div>

            <p class="form-help" style="margin-bottom: var(--space-md);">
                Select which hosts should appear in this episode
            </p>

            <div class="host-grid">
                {% for host in profile.hosts %}
                <label class="host-card selected">
                    <input type="checkbox" name="hosts" value="{{ host.id }}" checked>
                    <div class="host-avatar">
                        {{ host.name[0].upper() }}
                    </div>
                    <div class="host-info">
                        <h4>{{ host.name }}</h4>
                        <p>{{ host.role or 'Host' }}</p>
                    </div>
                </label>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Research Settings -->
        <div class="collapsible-section open">
            <div class="collapsible-header" onclick="toggleSection(this)">
                <span class="collapsible-title">
                    <i class="fas fa-search"></i>
                    Research Settings
                </span>
                <i class="fas fa-chevron-down collapsible-toggle"></i>
            </div>
            <div class="collapsible-content">
                <div class="form-group" style="margin-bottom: var(--space-lg);">
                    <label class="form-label">Research Depth</label>
                    <div class="radio-cards">
                        <label class="radio-card" onclick="selectRadio(this)">
                            <input type="radio" name="research_depth" value="quick">
                            <div class="radio-card-header">
                                <div class="radio-card-icon"><i class="fas fa-bolt"></i></div>
                                <span class="radio-card-title">Quick</span>
                            </div>
                            <p class="radio-card-desc">Headlines only, fastest generation</p>
                        </label>
                        <label class="radio-card selected" onclick="selectRadio(this)">
                            <input type="radio" name="research_depth" value="standard" checked>
                            <div class="radio-card-header">
                                <div class="radio-card-icon"><i class="fas fa-balance-scale"></i></div>
                                <span class="radio-card-title">Standard</span>
                            </div>
                            <p class="radio-card-desc">Full articles, balanced approach</p>
                        </label>
                        <label class="radio-card" onclick="selectRadio(this)">
                            <input type="radio" name="research_depth" value="deep">
                            <div class="radio-card-header">
                                <div class="radio-card-icon"><i class="fas fa-brain"></i></div>
                                <span class="radio-card-title">Deep</span>
                            </div>
                            <p class="radio-card-desc">Multi-source analysis, most thorough</p>
                        </label>
                    </div>
                </div>

                <div style="display: flex; flex-direction: column; gap: var(--space-md);">
                    <label class="toggle-option">
                        <input type="checkbox" name="deep_research" checked>
                        <div class="toggle-info">
                            <h4>AI Enhancement</h4>
                            <p>Use AI to find additional facts, statistics, and context</p>
                        </div>
                    </label>
                    <label class="toggle-option">
                        <input type="checkbox" name="use_continuity" checked>
                        <div class="toggle-info">
                            <h4>Episode Continuity</h4>
                            <p>Avoid repeating topics from recent episodes</p>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- AI Model Settings -->
        <div class="collapsible-section">
            <div class="collapsible-header" onclick="toggleSection(this)">
                <span class="collapsible-title">
                    <i class="fas fa-robot"></i>
                    AI & Model Settings
                </span>
                <i class="fas fa-chevron-down collapsible-toggle"></i>
            </div>
            <div class="collapsible-content">
                <div class="input-grid">
                    <div class="form-group">
                        <label class="form-label">Content Generation Model</label>
                        <select name="ai_model" class="form-select">
                            <option value="gemini-2.0-flash" selected>Gemini 2.0 Flash (Fast)</option>
                            <option value="gemini-2.0-pro">Gemini 2.0 Pro (Quality)</option>
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro (Balanced)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">TTS Model</label>
                        <select name="tts_model" class="form-select">
                            <option value="gemini-2.5-flash-preview-tts" selected>Gemini 2.5 Flash TTS</option>
                            <option value="gemini-2.5-pro-preview-tts">Gemini 2.5 Pro TTS</option>
                            <option value="elevenlabs">ElevenLabs (Premium)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audio Settings -->
        <div class="collapsible-section">
            <div class="collapsible-header" onclick="toggleSection(this)">
                <span class="collapsible-title">
                    <i class="fas fa-volume-up"></i>
                    Audio Settings
                </span>
                <i class="fas fa-chevron-down collapsible-toggle"></i>
            </div>
            <div class="collapsible-content">
                <div class="input-grid">
                    <div class="form-group">
                        <label class="form-label">Audio Quality</label>
                        <select name="audio_quality" class="form-select">
                            <option value="standard">Standard (128 kbps)</option>
                            <option value="high" selected>High (192 kbps)</option>
                            <option value="premium">Premium (320 kbps)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Speaking Speed</label>
                        <select name="speaking_speed" class="form-select">
                            <option value="0.9">Slower (0.9x)</option>
                            <option value="1.0" selected>Normal (1.0x)</option>
                            <option value="1.1">Faster (1.1x)</option>
                        </select>
                    </div>
                </div>
                <label class="toggle-option" style="margin-top: var(--space-lg);">
                    <input type="checkbox" name="background_music">
                    <div class="toggle-info">
                        <h4>Background Music</h4>
                        <p>Add subtle background music for a professional feel</p>
                    </div>
                </label>
            </div>
        </div>

        <!-- Output Options -->
        <div class="collapsible-section">
            <div class="collapsible-header" onclick="toggleSection(this)">
                <span class="collapsible-title">
                    <i class="fas fa-file-export"></i>
                    Output Options
                </span>
                <i class="fas fa-chevron-down collapsible-toggle"></i>
            </div>
            <div class="collapsible-content">
                <div style="display: flex; flex-direction: column; gap: var(--space-md);">
                    <label class="toggle-option">
                        <input type="checkbox" name="generate_audio" checked>
                        <div class="toggle-info">
                            <h4>Generate Audio</h4>
                            <p>Create MP3 audio file from the script</p>
                        </div>
                    </label>
                    <label class="toggle-option">
                        <input type="checkbox" name="generate_transcript" checked>
                        <div class="toggle-info">
                            <h4>Generate Transcript</h4>
                            <p>Create a text transcript of the episode</p>
                        </div>
                    </label>
                    <label class="toggle-option">
                        <input type="checkbox" name="generate_newsletter" checked>
                        <div class="toggle-info">
                            <h4>Generate Newsletter</h4>
                            <p>Create an email newsletter version</p>
                        </div>
                    </label>
                    <label class="toggle-option">
                        <input type="checkbox" name="editorial_review">
                        <div class="toggle-info">
                            <h4>Review Before Audio</h4>
                            <p>Pause for manual review after script generation</p>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
            <div class="action-bar-info">
                <i class="fas fa-info-circle"></i>
                <span>Generation typically takes 5-15 minutes</span>
            </div>
            <div class="action-buttons">
                <a href="/profiles/{{ profile.id }}" class="btn btn-secondary">
                    Cancel
                </a>
                <button type="submit" class="btn btn-primary btn-lg" id="generate-btn">
                    <i class="fas fa-play"></i>
                    Start Generation
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Duration slider
    function updateDuration(value) {
        const minutes = parseInt(value);
        document.getElementById('duration-value').textContent = minutes + ' min';

        // Estimate word count (roughly 150 words per minute)
        const words = Math.round(minutes * 150);
        document.getElementById('duration-estimate').textContent = `~${words.toLocaleString()} words`;

        updateEstimate();
    }

    // Update cost/time estimates
    function updateEstimate() {
        const duration = parseInt(document.getElementById('duration-slider').value);
        const topics = parseInt(document.getElementById('topic-count').value);
        const researchDepth = document.querySelector('input[name="research_depth"]:checked')?.value || 'standard';

        // Base time: 5 min + 0.5 min per minute of content + research depth modifier
        let baseTime = 5 + (duration * 0.5);
        if (researchDepth === 'deep') baseTime *= 1.5;
        if (researchDepth === 'quick') baseTime *= 0.7;

        // Cost estimate (rough)
        let cost = 0.05 + (duration * 0.015) + (topics * 0.02);
        if (researchDepth === 'deep') cost *= 1.3;

        document.getElementById('est-time').textContent = `~${Math.round(baseTime)} min`;
        document.getElementById('est-duration').textContent = `${duration} min`;
        document.getElementById('est-cost').textContent = `$${cost.toFixed(2)}`;

        // Count output files
        let outputs = 0;
        if (document.querySelector('input[name="generate_audio"]')?.checked) outputs++;
        if (document.querySelector('input[name="generate_transcript"]')?.checked) outputs++;
        if (document.querySelector('input[name="generate_newsletter"]')?.checked) outputs++;
        document.getElementById('est-output').textContent = outputs || 1;
    }

    // Toggle collapsible sections
    function toggleSection(header) {
        const section = header.closest('.collapsible-section');
        section.classList.toggle('open');
    }

    // Radio card selection
    function selectRadio(card) {
        const container = card.closest('.radio-cards');
        container.querySelectorAll('.radio-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        card.querySelector('input[type="radio"]').checked = true;
        updateEstimate();
    }

    // Host card selection
    document.querySelectorAll('.host-card').forEach(card => {
        card.addEventListener('click', () => {
            card.classList.toggle('selected');
            const checkbox = card.querySelector('input[type="checkbox"]');
            checkbox.checked = card.classList.contains('selected');
        });
    });

    // Output toggle change handlers
    document.querySelectorAll('.toggle-option input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', updateEstimate);
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        updateDuration(document.getElementById('duration-slider').value);
    });

    // Form submission
    document.getElementById('generation-form').addEventListener('submit', function(e) {
        const btn = document.getElementById('generate-btn');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Starting...';
    });
</script>
{% endblock %}
